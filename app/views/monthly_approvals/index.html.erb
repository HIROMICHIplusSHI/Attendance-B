<div class="modal-header">
  <h4 class="modal-title">所属長承認申請の承認</h4>
  <button type="button" class="close" data-action="bulk-modal#close">&times;</button>
</div>

<% if flash[:notice] %>
  <div class="alert alert-success" style="margin: 15px;">
    <%= flash[:notice] %>
  </div>
<% end %>

<% if flash[:alert] %>
  <div class="alert alert-danger" style="margin: 15px;">
    <%= flash[:alert] %>
  </div>
<% end %>

<%= form_with url: bulk_update_monthly_approvals_path, method: :patch,
              local: true,
              remote: true,
              html: {
                data: {
                  confirm: "true",
                  confirm_message: "変更内容を送信してよろしいですか？"
                }
              } do |f| %>
  <!-- クライアントサイドバリデーションエラー表示エリア -->
  <div id="validation-errors" class="alert alert-danger" style="margin: 15px; display: none;"></div>

  <div class="modal-body">
    <% if @approvals.any? %>
      <% @approvals.group_by(&:user).each do |user, approvals| %>
        <h5 style="margin-top: 20px; margin-bottom: 10px; padding: 10px; background-color: #f5f5f5; border-left: 4px solid #337ab7;">
          【<%= user.name %>さんからの申請】
        </h5>
        <table class="table table-bordered table-striped" style="margin-bottom: 30px;">
          <thead>
            <tr>
              <th>月</th>
              <th>承認/否認</th>
              <th>変更</th>
              <th>勤怠確認</th>
            </tr>
          </thead>
          <tbody>
            <% approvals.each do |approval| %>
              <tr>
                <td><%= l(approval.target_month, format: :middle) %></td>
                <td>
                  <%= f.select "approvals[#{approval.id}][status]",
                      options_for_select([
                        ['申請中', 'pending'],
                        ['承認', 'approved'],
                        ['否認', 'rejected']
                      ], approval.status),
                      {},
                      class: "form-control" %>
                </td>
                <td class="text-center">
                  <%= f.check_box "approvals[#{approval.id}][selected]", {}, '1', '0' %>
                </td>
                <td class="text-center">
                  <%= link_to "確認",
                      user_path(user, date: approval.target_month),
                      target: "_blank",
                      rel: "noopener noreferrer",
                      class: "btn btn-info btn-sm" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% end %>
    <% else %>
      <p class="text-center text-muted">承認待ちの申請はありません</p>
    <% end %>
  </div>

  <div class="modal-footer">
    <button type="button" class="btn btn-default" data-action="bulk-modal#close">キャンセル</button>
    <% if @approvals.any? %>
      <%= f.submit "変更を送信する", class: "btn btn-primary", data: { turbo_confirm: "変更内容を送信してよろしいですか？" } %>
    <% end %>
  </div>
<% end %>
