<% provide(:title, @user.name) %>

<div class="row">
  <div class="col-md-12">
    <!-- 月次ナビゲーション -->
    <div class="text-center">
      <%= link_to "⇐ 前月", user_path(@user, date: @first_day.prev_month), class: "btn btn-default" %>
      <span class="h4"><%= l(@first_day, format: :middle) %></span>
      <%= link_to "次月 ⇒", user_path(@user, date: @first_day.next_month), class: "btn btn-default" %>
    </div>

    <!-- 時間管理表ヘッダー -->
    <table class="table table-bordered table-condensed user-table">
      <tr>
        <td><%= l(@first_day, format: :middle) %> 時間管理表</td>
        <td>指定勤務時間：<%= format_basic_info(@user.work_time) %></td>
        <td>基本時間：<%= format_basic_info(@user.basic_time) %></td>
        <td>初日：<%= l(@first_day, format: :short) %></td>
      </tr>
    </table>

    <!-- 勤怠テーブル -->
    <table class="table table-bordered table-condensed table-hover text-center" id="table-attendances">
      <thead>
        <tr>
          <th rowspan="3">残業申請</th>
          <th rowspan="3">日付</th>
          <th rowspan="3">曜日</th>
          <th colspan="8">実績</th>
          <th rowspan="3">備考</th>
        </tr>
        <tr>
          <th colspan="3">出社</th>
          <th colspan="3">退社</th>
          <th rowspan="2">在社時間</th>
          <th rowspan="2">備考</th>
        </tr>
        <tr>
          <th>時</th>
          <th>分</th>
          <th></th>
          <th>時</th>
          <th>分</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @attendances.each do |attendance| %>
          <tr>
            <td></td>
            <td><%= l(attendance.worked_on, format: :short) %></td>
            <td><%= ApplicationController::DAYS_OF_THE_WEEK[attendance.worked_on.wday] %></td>
            <!-- 出勤時間 -->
            <% if attendance_state(attendance) == '出勤' %>
              <td colspan="3">
                <%= form_with(model: [@user, attendance], local: true) do |f| %>
                  <%= f.time_field :started_at, class: "form-control", style: "width: 80px; display: inline;" %>
                  <%= f.submit "出勤", class: "btn btn-primary btn-xs" %>
                <% end %>
              </td>
            <% else %>
              <td><%= attendance.started_at&.hour %></td>
              <td><%= attendance.started_at&.min %></td>
              <td></td>
            <% end %>

            <!-- 退勤時間 -->
            <% if attendance_state(attendance) == '退勤' %>
              <td colspan="3">
                <%= form_with(model: [@user, attendance], local: true) do |f| %>
                  <%= f.time_field :finished_at, class: "form-control", style: "width: 80px; display: inline;" %>
                  <%= f.submit "退勤", class: "btn btn-danger btn-xs" %>
                <% end %>
              </td>
            <% else %>
              <td><%= attendance.finished_at&.hour %></td>
              <td><%= attendance.finished_at&.min %></td>
              <td></td>
            <% end %>

            <!-- 在社時間 -->
            <td>
              <% if attendance.started_at.present? && attendance.finished_at.present? %>
                <%= working_times(attendance.started_at, attendance.finished_at) %>
              <% end %>
            </td>
            <td></td>
            <td><%= attendance.note %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>