<div class="modal-header">
  <h4 class="modal-title">勤怠変更・残業申請</h4>
  <button type="button" class="close" data-action="form-modal#close">&times;</button>
</div>

<% if flash[:danger] %>
  <div class="alert alert-danger" style="margin: 15px;">
    <%= flash[:danger] %>
  </div>
<% end %>

<%= form_with url: user_attendance_application_requests_path(@attendance.user, @attendance),
              scope: :application_request,
              id: "application-request-form",
              local: true,
              remote: true,
              html: { data: { confirm: "true", confirm_message: "この内容で申請してよろしいですか？" } } do |f| %>
  <div class="modal-body">
    <!-- 日付情報 -->
    <div class="form-group">
      <label>日付</label>
      <p class="form-control-static"><%= @attendance.worked_on.strftime('%Y年%m月%d日 (%a)') %></p>
    </div>

    <!-- 勤怠変更セクション -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h5 class="panel-title">勤怠変更</h5>
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label>変更前 出社時間</label>
              <p class="form-control-static">
                <%= @attendance.started_at&.strftime('%H:%M') || '未登録' %>
              </p>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label>変更前 退社時間</label>
              <p class="form-control-static">
                <%= @attendance.finished_at&.strftime('%H:%M') || '未登録' %>
              </p>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label>変更後 出社時間</label>
              <%= f.time_field :requested_started_at, class: "form-control", value: @params&.[](:requested_started_at) %>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label>変更後 退社時間</label>
              <%= f.time_field :requested_finished_at, class: "form-control", value: @params&.[](:requested_finished_at) %>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>変更理由（備考）</label>
          <%= f.text_area :change_reason, class: "form-control", rows: 3, value: @params&.[](:change_reason) %>
        </div>
      </div>
    </div>

    <!-- 残業申請セクション -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h5 class="panel-title">残業申請</h5>
      </div>
      <div class="panel-body">
        <div class="form-group">
          <label>終了予定時間</label>
          <%= f.time_field :estimated_end_time, class: "form-control", value: @params&.[](:estimated_end_time) %>
        </div>

        <div class="form-group">
          <label>業務内容</label>
          <%= f.text_area :business_content, class: "form-control", rows: 3, maxlength: 500, value: @params&.[](:business_content) %>
          <span class="help-block">500文字以内</span>
        </div>
      </div>
    </div>

    <!-- 上長選択 -->
    <div class="form-group">
      <label>承認者を選択 <span class="text-danger">*</span></label>
      <%= f.select :approver_id,
          options_from_collection_for_select(
            User.manager.where.not(id: @attendance.user.id).order(:name),
            :id,
            :name,
            @params&.[](:approver_id) || @attendance.user.manager_id
          ),
          { prompt: "承認者を選択してください" },
          class: "form-control" %>
    </div>
  </div>

  <div class="modal-footer">
    <button type="button" class="btn btn-default" data-action="form-modal#close">キャンセル</button>
    <%= f.submit "申請", class: "btn btn-primary" %>
  </div>
<% end %>
